<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Blog - Strona Główna</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f0f2f5;
      display: flex;
      justify-content: center;
      align-items: flex-start; /* flex-start żeby przy dużej ilości postów strona się przewijała */
      min-height: 100vh;
      margin: 0;
      padding-top: 50px;
    }
    .container {
      background-color: white;
      width: 600px;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h1 { text-align: center; color: #333; }
    .nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }
    .post {
      border: 1px solid #e1e1e1;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      background-color: #fafafa;
    }
    .post h3 { margin-top: 0; color: #0056b3; }
    .post small { color: #777; display: block; margin-top: 10px; }

    /* Style przycisków */
    button {
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s;
    }
    .btn-primary { background-color: #007bff; color: white; }
    .btn-primary:hover { background-color: #0056b3; }

    .btn-secondary { background-color: #6c757d; color: white; }
    .btn-secondary:hover { background-color: #545b62; }

    .btn-danger { background-color: #dc3545; color: white; float: right; }
    .btn-danger:hover { background-color: #a71d2a; }

    a { text-decoration: none; }
  </style>
</head>
<body>

<div class="container">
  <div class="nav" id="nav-bar">
    <!-- JS wstrzyknie tu przyciski -->
  </div>

  <h1>Tablica Postów</h1>
  <div id="posts-container" style="text-align: center; color: #666;">Ładowanie postów...</div>
</div>

<script>
  const navBar = document.getElementById('nav-bar');
  const postsContainer = document.getElementById('posts-container');
  const token = localStorage.getItem('jwt_token');

  if (token) {
    navBar.innerHTML = `
                <span>Zalogowany</span>
                <div>
                    <a href="add-post.html"><button class="btn-primary">Dodaj Post</button></a>
                    <button class="btn-secondary" onclick="logout()">Wyloguj</button>
                </div>
            `;
  } else {
    navBar.innerHTML = `
                <span>Witaj!</span>
                <div>
                    <a href="login.html"><button class="btn-primary">Logowanie</button></a>
                    <a href="register.html"><button class="btn-secondary">Rejestracja</button></a>
                </div>
            `;
  }

  function logout() {
    localStorage.removeItem('jwt_token');
    window.location.reload();
  }

  fetch('/posts')
          .then(response => response.json())
          .then(posts => {
            postsContainer.innerHTML = '';
            if(posts.length === 0) postsContainer.innerHTML = 'Brak postów do wyświetlenia.';

            posts.forEach(post => {
              const postDiv = document.createElement('div');
              postDiv.className = 'post';
              postDiv.innerHTML = `
                        <h3>${post.title}</h3>
                        <p>${post.content}</p>
                        <small>Autor: <b>${post.authorName}</b></small>
                        ${token ? `<button class="btn-danger" onclick="deletePost(${post.id})">Usuń</button>` : ''}
                        <div style="clear: both;"></div>
                    `;
              postsContainer.appendChild(postDiv);
            });
          })
          .catch(err => console.error(err));

  function deletePost(id) {
    if(!confirm("Czy na pewno usunąć?")) return;
    fetch('/posts/' + id, {
      method: 'DELETE',
      headers: { 'Authorization': 'Bearer ' + token }
    }).then(response => {
      if(response.ok) window.location.reload();
      else alert("Błąd! Może to nie Twój post?");
    });
  }
</script>
</body>
</html>